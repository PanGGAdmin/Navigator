<!-- 销售报价单 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/gongong.css">
    <link rel="stylesheet" href="../css/tp/tp.css">
    <title>销售报价单</title>
</head>
<style>
    .he{
        width:100px;
        height:100px;
        border: 3px solid red;
        text-align: center;
        border-radius: 100%;
        font-size: 70px;
        line-height: 100px;
        font-weight: bold;
        color: red;
        position: absolute;
        top: 5px;
        right: 30px;
    }
</style>
<body class="layui-fluid">
    <form class="layui-form layui-form-pane" action="">
        <div class="layui-row layui-col-space20">
            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-form-item">
                    <div class="layui-col-md4  layui-col-xs5">
                        <input type="checkbox" id="tpcheckUser" title="正式客户" lay-filter="checkUser" checked>
                    </div>
                    <div class="layui-col-md8  layui-col-xs7">
                        <select id="tpmodules" name="modules" lay-verify="required" lay-search="" lay-filter="modules">
                            <option value="">直接选择或搜索选择</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">送货地址</label>
                    <div class="layui-input-block">
                        <div class="layui-col-md4 layui-col-xs4"><input type="text" id="tpaddressId" required lay-verify="required" autocomplete="off" class="layui-input"></div>
                        <div class="layui-col-md8  layui-col-xs8"><input type="text" id="tpaddressName" required lay-verify="required" autocomplete="off" class="layui-input"></div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">有效日期</label>
                    <div class="layui-input-block">
                        <input type="text" name="date" id="date" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">单价是否含税</label>
                    <div class="layui-input-block">
                        <select id="quPri cetax" lay-verify="required">
                            <option value="0">未税</option>
                            <option value="1">含税</option>
                        </select>
                    </div>
                </div>

            </div>



            <div class="layui-col-md6  layui-col-xs6">
                <div class="layui-form-item">
                    <label class="layui-form-label">单据日期</label>
                    <div class="layui-input-block">
                        <input type="text" name="date1" id="date1" lay-verify="date1" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">单据号码</label>
                    <div class="layui-input-block">
                        <input type="text" id="tpQuId" required lay-verify="required" autocomplete="off" class="layui-input" disabled>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">币别</label>
                    <div class="layui-input-block">
                        <input type="text" id="quMoneytype" required lay-verify="required" autocomplete="off" class="layui-input" value="人民币">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">汇率</label>
                    <div class="layui-input-block">
                        <input type="text" id="quExchangerate" required lay-verify="required" autocomplete="off" class="layui-input" value="1.000">
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row">
            <div class="layui-tab layui-tab-card">
                <ul class="layui-tab-title">
                    <li class="layui-this">内容</li>
                    <li>备注</li>
                </ul>
                <div class="layui-tab-content" style="overflow:auto;">
                    <div class="layui-tab-item layui-show">
                        <table class="layui-table" lay-filter="tpSalesPriceTable" lay-data="{width:2000,height:300}"id="tpSalesPriceTable">
                        </table>
                    </div>
                    <div class="layui-tab-item">
                        <div class="layui-row  layui-col-space20">
                            <div class="layui-col-md6 layui-col-xs6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">表头条纹</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">自定义栏一</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>

                            <div class="layui-col-md6 layui-col-xs6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">表尾条纹</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">自定义栏二</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row  layui-col-space20">
            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-form-item">
                    <label class="layui-form-label">业务人员</label>
                    <div class="layui-input-block">
                        <input type="text" id="quPeoywName" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">所属部门</label>
                    <div class="layui-input-block">
                        <input type="text" id="quEmpName" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-form-item">
                    <label class="layui-form-label">制单人员</label>
                    <div class="layui-input-block">
                        <input type="text" id="quPerzdName" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">复核人员</label>
                    <div class="layui-input-block">
                        <input type="text" id="quPerckName" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-row  layui-col-space20">
            <div class="layui-col-md3 layui-col-xs3">
                <div class="layui-form-item">
                    <label class="layui-form-label">查询</label>
                    <div class="layui-input-block">
                        <select name="" lay-verify="required">
                            <option value="0">历史记录查询</option>
                            <option value="1">利润预估查询</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-col-md3 layui-col-xs3">
                <div class="layui-form-item">
                    <label class="layui-form-label">功能</label>
                    <div class="layui-input-block">
                        <select name="" lay-verify="required">
                            <option value="0">批次变更价格</option>
                            <option value="1">发送email</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-btn-group">
                    <button class="layui-btn layui-btn-sm">
                        新增
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        修改
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        保存
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        删除
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        审核
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        取消审核
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        <i class="layui-icon">&#xe65a;</i>
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        <i class="layui-icon">&#xe603;</i>
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        <i class="layui-icon">&#xe602;</i>
                    </button>
                    <button class="layui-btn layui-btn-sm">
                        <i class="layui-icon">&#xe65b;</i>
                    </button>
                </div>
            </div>
        </div>
    </form>

    <div class="he">核</div>
</body>

<script src="../jquery/jquery-3.3.1.min.js"></script>
<script src="../layui/layui.all.js"></script>
<script src="../js/gonggong.js"></script>
<script>
    layui.use(['form', 'layedit', 'laydate', 'table'], function() {
        var table = layui.table;
        var form = layui.form,
            laydate = layui.laydate;

        //单据日期监听
        laydate.render({
            elem: '#date1',
            value:new Date(),
            change: function(value, date, endDate){
                $.ajax({
                    url:"/queryMaxQuId",
                    type:"GET",
                    data:{"dateStr":value},
                    dataType: "json",
                    success: function(data){
                        $("#tpQuId").val(data);
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            },
            done: function(value, date, endDate){
                $.ajax({
                    url:"/queryMaxQuId",
                    type:"GET",
                    data:{"dateStr":value},
                    dataType: "json",
                    success: function(data){
                        $("#tpQuId").val(data);
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            }
        });

        //日期
        laydate.render({
            elem: '#date',
            value:new Date()
        });

        //监听单元格编辑
        table.on('edit(test3)', function(obj) {
            var value = obj.value //得到修改后的值
                ,
                data = obj.data //得到所在行所有键值
                ,
                field = obj.field; //得到字段
            layer.msg('[ID: ' + data.id + '] ' + field + ' 字段更改为：' + value);
        });

        form.render();
        //加载页面查询正式客户
        $.ajax({
            url:"/queryClientMasterfile",
            type:"GET",
            data:{},
            dataType: "json",
            success: function(data){
                var option='<option value="">直接选择或搜索选择</option>';
                jQuery("#modules").html("");
                $.each(data.queryClientMasterfileData,function(i,obj){
                     option+='<option value="'+obj.id+'">'+obj.shortName+'</option>';

                })
                $("#tpmodules").html(option);
                form.render();
            },
            error:function (xhr) {
                layer.msg('服务器连接失败');
            }
        });
        var datachecked=true;
        //正式客户复选框监听
        form.on('checkbox(checkUser)', function(data){
            datachecked=data.elem.checked;
            //勾选，查询正式客户
            if(data.elem.checked){
                $.ajax({
                    url:"/queryClientMasterfile",
                    type:"GET",
                    data:{},
                    dataType: "json",
                    success: function(data){
                        var option='<option value="">直接选择或搜索选择</option>';
                        jQuery("#modules").html("");
                        $.each(data.queryClientMasterfileData,function(i,obj){
                            option+='<option value="'+obj.id+'">'+obj.shortName+'</option>';

                        })
                        $("#tpmodules").html(option);
                        form.render();
                        $("#tpaddressId").val('');
                        $("#tpaddressName").val('');
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            }else {
                //不勾选，查询潜在客户
                $.ajax({
                    url:"/queryPotentialClientFile",
                    type:"GET",
                    data:{},
                    dataType: "json",
                    success: function(data){
                        var option='<option value="">直接选择或搜索选择</option>';
                        jQuery("#modules").html("");
                        $.each(data.queryPotentialClientFileData,function(i,obj){
                            option+='<option value="'+obj.id+'">'+obj.shortName+'</option>';

                        })
                        $("#tpmodules").html(option);
                        form.render();
                        $("#tpaddressId").val('');
                        $("#tpaddressName").val('');
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            }

        });

        //客户下拉框监听事件
        form.on('select(modules)', function(data){
            if(data.value!="") {
                if(datachecked){
                    $.ajax({
                        url:"/queryClientMasterfileAddress",
                        type:"GET",
                        data:{addressid:data.value},
                        dataType: "json",
                        success: function(data){
                            console.info(data);
                            $("#tpaddressId").val(data.queryClientMasterfileAddressData[0].addrID);
                            $("#tpaddressName").val(data.queryClientMasterfileAddressData[0].address);
                        },
                        error:function (xhr) {
                            layer.msg('服务器连接失败');
                        }
                    });
                }else{
                    $.ajax({
                        url:"/queryPotentialClientFileAddress",
                        type:"GET",
                        data:{addressid:data.value},
                        dataType: "json",
                        success: function(data){
                            console.info(data);
                            $("#tpaddressId").val(data.queryPotentialClientFileAddressData[0].addrid);
                            $("#tpaddressName").val(data.queryPotentialClientFileAddressData[0].address);
                        },
                        error:function (xhr) {
                            layer.msg('服务器连接失败');
                        }
                    });
                }
            }else{
                $("#tpaddressId").val('');
                $("#tpaddressName").val('');
            }
        });

        /**
         * 获取数据
         * @type {Array}
         */
        var tableData=new Array(); // 用于存放表格数据
        $.ajax({
            url: "/querySellQuote"
            ,data:{"pageSize":1}
            ,type:"get"
            ,async:false
            ,dataType:"json"
            , success: function(result){

                tableData=result.sSellQuoteparticulars;
                console.log(result);
            }
        });

        /**
         * 为数据表格增加数据
         */
        table.render({
            elem: '#tpSalesPriceTable'
            ,data:tableData
            ,height: 315//容器高度
            ,cols: [[//表头
                {type:'checkbox',LAY_CHECKED:true}
                ,{title : '序号',type:'numbers',width: 50, title:'(栏号)'}
                ,{field:'qpMaterielid'    , title:'物料编号'  , width: 250  , sort: true}
                ,{field:'qpMaterielname' , title:'(物料名称)', width: 250 }
                ,{field:'qpModel'  , title:'(规格型号)' , width: 250, sort: true, edit: 'text'}
                ,{field:'qpUnitname' , title:'(单位名称)', width: 120, sort: true }
                ,{field:'qpNumber'    , title:'数量'   , width: 250,  edit: 'text'}
                ,{field:'qpDiscountprice'  , title:'折扣前单价' , width: 250}
                ,{field:'qpDiscount'  , title:'折数(%)' , width: 250}
                ,{field:'qpPrice'  , title:'单价' , width: 250}
                ,{field:'qpSum'  , title:'金额' , width: 250}
                ,{field:'qpRate'  , title:'税率(%)' , width: 250}
                ,{field:'qpTatemoney'  , title:'(税额)' , width: 250}
                ,{field:'qpTotalmoney'  , title:'(含税金额)' , width: 250}
                ,{field:'qpLargess'  , title:'赠品' , width: 250}
                ,{field:'qpRemark'  , title:'分录备注' , width: 250}
            ]]
            ,page: {
                layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                ,curr: 1 //设定初始在第 1 页
                ,groups: 1 //只显示 1 个连续页码
                ,first: true //不显示首页
                ,last: true //不显示尾页
            }
            , done: function(res, curr, count){
            }

        });
    });
    $(function(){
        var endtime=new Date();
        var dateYear = endtime.getFullYear();
        var dateMonth=(endtime.getMonth()+1)<10?"0"+(endtime.getMonth()+1) :(endtime.getMonth()+1);
        var dateDay=endtime.getDate()<10?"0"+endtime.getDate() :endtime.getDate();
        var dateStr=dateYear+"-"+dateMonth+"-"+dateDay;
        $.ajax({
            url:"/queryMaxQuId",
            type:"GET",
            data:{"dateStr":dateStr},
            dataType: "json",
            success: function(data){
                console.info(data);
                $("#tpQuId").val(data);
            },
            error:function (xhr) {
                layer.msg('服务器连接失败');
            }
        });

       /* //点击加号按钮时，新添一行
        $("#tpSalesPriceTable").click(function(){
            alert(11)
            var oldData =  table.cache["baseInfo"];
            var data1={"colName":"ID2","colNo":0,"collator":"","comments":"","dbId":1,"defVal":"","deleted":"","dispersion":0,"domainId":0,"histogram":"","isHide":"","isSerial":"F","isVirtual":"","maxVal":"","minVal":"","notNull":"T","repetRate":0,"scale":-1,"serialId":0,"tableId":1048586,"timestampT":" ","typeName":"INTEGER","varying":"F","vcolNo":0,"vertNo":0};
            oldData.push(data1);
            table.reload('baseInfo',{
                data : oldData
            });
        });*/
    })
</script>

</html>