<!-- 销售报价单 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../layui/css/layui.css" media="all">
    <link rel="stylesheet" href="../css/gongong.css">
    <link rel="stylesheet" href="../css/tp/tp.css">
    <title>销售报价单</title>
</head>

<body class="layui-fluid">
    <form class="layui-form layui-form-pane" action="">
        <div class="layui-row layui-col-space20">
            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-form-item">
                    <div class="layui-col-md4  layui-col-xs5">
                        <input type="checkbox" id="tpcheckUser" title="正式客户" lay-filter="checkUser" checked>
                    </div>
                    <div class="layui-col-md8  layui-col-xs7">
                        <select id="tpmodules" name="modules" lay-verify="required" lay-search="" lay-filter="modules">
                            <option value="">直接选择或搜索选择</option>
                        </select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">送货地址</label>
                    <div class="layui-input-block">
                        <div class="layui-col-md4 layui-col-xs4"><input type="text" id="tpaddressId" required lay-verify="required" autocomplete="off" class="layui-input"></div>
                        <div class="layui-col-md8  layui-col-xs8"><input type="text" id="tpaddressName" required lay-verify="required" autocomplete="off" class="layui-input"></div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">有效日期</label>
                    <div class="layui-input-block">
                        <input type="text" name="date" id="date" lay-verify="date" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">单价是否含税</label>
                    <div class="layui-input-block">
                        <select name="" lay-verify="required">
                            <option value="0">未税</option>
                            <option value="1">含税</option>
                        </select>
                    </div>
                </div>

            </div>



            <div class="layui-col-md6  layui-col-xs6">
                <div class="layui-form-item">
                    <label class="layui-form-label">单据日期</label>
                    <div class="layui-input-block">
                        <input type="text" name="date1" id="date1" lay-verify="date1" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">单据号码</label>
                    <div class="layui-input-block">
                        <input type="text" id="tpQuId" required lay-verify="required" autocomplete="off" class="layui-input" disabled>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">币别</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">汇率</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row">
            <div class="layui-tab layui-tab-card">
                <ul class="layui-tab-title">
                    <li class="layui-this">内容</li>
                    <li>备注</li>
                </ul>
                <div class="layui-tab-content" style="overflow:auto;">
                    <div class="layui-tab-item layui-show">
                        <table class="layui-table" lay-filter="test3" style="width: 3000px;">
                            <thead>
                                <tr>
                                    <th lay-data="{field:'id', sort: true}">(栏号)</th>
                                    <th lay-data="{field:'username', sort: true, edit: 'text'}">物料编号</th>
                                    <th lay-data="{field:'email', sort: true ,edit: 'text'}">(物料名称)</th>
                                    <th lay-data="{field:'sex', sort: true ,edit: 'text'}">(规格型号)</th>
                                    <th lay-data="{field:'city', sort: true,edit: 'text'}">(单位名称)</th>
                                    <th lay-data="{field:'experience', sort: true, edit: 'text'}">数量</th>
                                    <th lay-data="{field:'username', sort: true, edit: 'text'}">折扣前单价</th>
                                    <th lay-data="{field:'email', sort: true ,edit: 'text'}">折数(%)</th>
                                    <th lay-data="{field:'sex', sort: true ,edit: 'text'}">单价</th>
                                    <th lay-data="{field:'city', sort: true,edit: 'text'}">金额</th>
                                    <th lay-data="{field:'experience', sort: true, edit: 'text'}">税率(%)</th>
                                    <th lay-data="{field:'email', sort: true ,edit: 'text'}">(税额)</th>
                                    <th lay-data="{field:'sex', sort: true ,edit: 'text'}">(含税金额)</th>
                                    <th lay-data="{field:'city', sort: true,edit: 'text'}">赠品</th>
                                    <th lay-data="{field:'experience', sort: true, edit: 'text'}">分录备注</th>
                                </tr>
                            </thead>
                            <tfoot>
                                <tr>
                                    <th colspan="5">合计：</th>
                                    <th>数量</th>
                                    <th></th>
                                    <th></th>
                                    <th></th>
                                    <th>金额</th>
                                    <th></th>
                                    <th>税额</th>
                                    <th colspan="3">含税金额</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="layui-tab-item">
                        <div class="layui-row  layui-col-space20">
                            <div class="layui-col-md6 layui-col-xs6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">表头条纹</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">自定义栏一</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>

                            <div class="layui-col-md6 layui-col-xs6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">表尾条纹</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>

                                <div class="layui-form-item">
                                    <label class="layui-form-label">自定义栏二</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row  layui-col-space20">
            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-form-item">
                    <label class="layui-form-label">业务人员</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">所属部门</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>

            <div class="layui-col-md6 layui-col-xs6">
                <div class="layui-form-item">
                    <label class="layui-form-label">制单人员</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">复核人员</label>
                    <div class="layui-input-block">
                        <input type="text" name="title" required lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
        </div>

        <div class="layui-row  layui-col-space20">
            <div class="layui-col-md3 layui-col-xs5">
                <div class="layui-form-item">
                    <label class="layui-form-label">查询</label>
                    <div class="layui-input-block">
                        <select name="" lay-verify="required">
                                <option value="0">历史记录查询</option>
                                <option value="1">利润预估查询</option>
                            </select>
                    </div>
                </div>
            </div>
            <div class="layui-col-md3 layui-col-xs5">
                <div class="layui-form-item">
                    <label class="layui-form-label">功能</label>
                    <div class="layui-input-block">
                        <select name="" lay-verify="required">
                                    <option value="0">批次变更价格</option>
                                    <option value="1">发送email</option>
                                </select>
                    </div>
                </div>
            </div>
        </div>

    </form>
</body>

<script src="../jquery/jquery-3.3.1.min.js"></script>
<script src="../layui/layui.all.js"></script>
<script src="../js/gonggong.js"></script>
<script>
    layui.use(['form', 'layedit', 'laydate', 'table'], function() {
        var table = layui.table;
        var form = layui.form,
            laydate = layui.laydate;

        //单据日期监听
        laydate.render({
            elem: '#date1',
            value:new Date(),
            change: function(value, date, endDate){
                $.ajax({
                    url:"/queryMaxQuId",
                    type:"GET",
                    data:{"dateStr":value},
                    dataType: "json",
                    success: function(data){
                        $("#tpQuId").val(data);
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            },
            done: function(value, date, endDate){
                $.ajax({
                    url:"/queryMaxQuId",
                    type:"GET",
                    data:{"dateStr":value},
                    dataType: "json",
                    success: function(data){
                        $("#tpQuId").val(data);
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            }
        });

        //日期
        laydate.render({
            elem: '#date',
            value:new Date()
        });

        //监听单元格编辑
        table.on('edit(test3)', function(obj) {
            var value = obj.value //得到修改后的值
                ,
                data = obj.data //得到所在行所有键值
                ,
                field = obj.field; //得到字段
            layer.msg('[ID: ' + data.id + '] ' + field + ' 字段更改为：' + value);
        });

        form.render();
        //加载页面查询正式客户
        $.ajax({
            url:"/queryClientMasterfile",
            type:"GET",
            data:{},
            dataType: "json",
            success: function(data){
                var option='<option value="">直接选择或搜索选择</option>';
                jQuery("#modules").html("");
                $.each(data.queryClientMasterfileData,function(i,obj){
                     option+='<option value="'+obj.id+'">'+obj.shortName+'</option>';

                })
                $("#tpmodules").html(option);
                form.render();
            },
            error:function (xhr) {
                layer.msg('服务器连接失败');
            }
        });
        var datachecked=true;
        //正式客户复选框监听
        form.on('checkbox(checkUser)', function(data){
            datachecked=data.elem.checked;
            //勾选，查询正式客户
            if(data.elem.checked){
                $.ajax({
                    url:"/queryClientMasterfile",
                    type:"GET",
                    data:{},
                    dataType: "json",
                    success: function(data){
                        var option='<option value="">直接选择或搜索选择</option>';
                        jQuery("#modules").html("");
                        $.each(data.queryClientMasterfileData,function(i,obj){
                            option+='<option value="'+obj.id+'">'+obj.shortName+'</option>';

                        })
                        $("#tpmodules").html(option);
                        form.render();
                        $("#tpaddressId").val('');
                        $("#tpaddressName").val('');
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            }else {
                //不勾选，查询潜在客户
                $.ajax({
                    url:"/queryPotentialClientFile",
                    type:"GET",
                    data:{},
                    dataType: "json",
                    success: function(data){
                        var option='<option value="">直接选择或搜索选择</option>';
                        jQuery("#modules").html("");
                        $.each(data.queryPotentialClientFileData,function(i,obj){
                            option+='<option value="'+obj.id+'">'+obj.shortName+'</option>';

                        })
                        $("#tpmodules").html(option);
                        form.render();
                        $("#tpaddressId").val('');
                        $("#tpaddressName").val('');
                    },
                    error:function (xhr) {
                        layer.msg('服务器连接失败');
                    }
                });
            }

        });

        //客户下拉框监听事件
        form.on('select(modules)', function(data){
            if(data.value!="") {
                if(datachecked){
                    $.ajax({
                        url:"/queryClientMasterfileAddress",
                        type:"GET",
                        data:{addressid:data.value},
                        dataType: "json",
                        success: function(data){
                            console.info(data);
                            $("#tpaddressId").val(data.queryClientMasterfileAddressData[0].addrID);
                            $("#tpaddressName").val(data.queryClientMasterfileAddressData[0].address);
                        },
                        error:function (xhr) {
                            layer.msg('服务器连接失败');
                        }
                    });
                }else{
                    $.ajax({
                        url:"/queryPotentialClientFileAddress",
                        type:"GET",
                        data:{addressid:data.value},
                        dataType: "json",
                        success: function(data){
                            console.info(data);
                            $("#tpaddressId").val(data.queryPotentialClientFileAddressData[0].addrid);
                            $("#tpaddressName").val(data.queryPotentialClientFileAddressData[0].address);
                        },
                        error:function (xhr) {
                            layer.msg('服务器连接失败');
                        }
                    });
                }
            }else{
                $("#tpaddressId").val('');
                $("#tpaddressName").val('');
            }
        });
    });
    $(function(){
        var endtime=new Date();
        var dateYear = endtime.getFullYear();
        var dateMonth=(endtime.getMonth()+1)<10?"0"+(endtime.getMonth()+1) :(endtime.getMonth()+1);
        var dateDay=endtime.getDate()<10?"0"+endtime.getDate() :endtime.getDate();
        var dateStr=dateYear+"-"+dateMonth+"-"+dateDay;
        $.ajax({
            url:"/queryMaxQuId",
            type:"GET",
            data:{"dateStr":dateStr},
            dataType: "json",
            success: function(data){
                $("#tpQuId").val(data);
            },
            error:function (xhr) {
                layer.msg('服务器连接失败');
            }
        });
    })
</script>

</html>